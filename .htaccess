# DirectoryIndex perecat.html

# Errorpages
Options All -Indexes
ErrorDocument 404 /files/error-pages/404.html
ErrorDocument 403 /files/error-pages/403.html

# Configurations
AddDefaultCharset utf-8

RewriteEngine on
RewriteBase /
RewriteCond %{THE_REQUEST} ^[A-Z]{3,9}\ /([^.]+)\.html\ HTTP
RewriteRule ^([^.]+)\.html$ /$1 [R=301,L]
RewriteCond %{REQUEST_URI} !(\.[^./]+)$
RewriteCond %{REQUEST_fileNAME} !-d
RewriteCond %{REQUEST_fileNAME} !-f
RewriteRule (.*) /$1.html [L]

RewriteEngine on
RewriteCond %{HTTP_HOST} ^www\.
RewriteCond %{HTTPS}s ^on(s)|off
RewriteCond http%1://%{HTTP_HOST} ^(https?://)(www\.)?(.+)$
RewriteRule ^ %1%3%{REQUEST_URI} [R=301,L]

RewriteEngine on
RewriteCond %{HTTPS} !on
RewriteRule (.*) https://%{HTTP_HOST}%{REQUEST_URI}

<IfModule mod_headers.c>
	Header set Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" env=HTTPS

	Header set Content-Security-Policy "default-src 'self' https:; \
		connect-src 'self' https: mc.yandex.ru; \
		child-src 'self' https: asianwaveru.chatovod.ru vk.com *.youtube-nocookie.com; \
		frame-ancestors 'self' https: vk.com; \
		style-src 'self' https: 'unsafe-inline' *.googleapis.com; \
		font-src 'self' https: *.gstatic.com; \
		img-src 'self' data: https: vk.com www.google-analytics.com mc.yandex.ru; \
		media-src 'self' *.myradio24.com; \
		script-src 'self' https: 'unsafe-inline' www.google-analytics.com mc.yandex.ru vk.com cdnjs.cloudflare.com cdn.jsdelivr.net; \
		plugin-types application/x-shockwave-flash"
</IfModule>

<IfModule mod_deflate.c>
	<IfModule mod_setenvif.c>
		<IfModule mod_headers.c>
			SetEnvIfNoCase ^(Accept-EncodXng|X-cept-Encoding|X{15}|~{15}|-{15})$ ^((gzip|deflate)\s*,?\s*)+|[X~-]{4,13}$ HAVE_Accept-Encoding
			RequestHeader append Accept-Encoding "gzip,deflate" env=HAVE_Accept-Encoding
		</IfModule>
	</IfModule>

	<IfModule mod_filter.c>
		AddOutputFilterByType DEFLATE application/atom+xml \
									  application/javascript \
									  application/json \
									  application/rss+xml \
									  application/vnd.ms-fontobject \
									  application/x-font-ttf \
									  application/x-web-app-manifest+json \
									  application/xhtml+xml \
									  application/xml \
									  font/opentype \
									  image/svg+xml \
									  image/x-icon \
									  text/css \
									  text/html \
									  text/plain \
									  text/x-component \
									  text/xml
	</IfModule>
</IfModule>

<FilesMatch "\.(gif|jpe?g|png|ico|css|js|swf)$">
	Header set Cache-Control "max-age=172800, public, must-revalidate"
</FilesMatch>

# расширения
Redirect 301 /app--vk https://vk.com/app4426688
Redirect 301 /app--chrome https://chrome.google.com/webstore/detail/ecbegehkeefmdjnjhldeogkhbhhjhfje
Redirect 301 /app--opera https://addons.opera.com/ru/extensions/details/asian-wave/

# фикс адресов разделов
Redirect 301 /anime/ /anime
Redirect 301 /radio/ /radio
